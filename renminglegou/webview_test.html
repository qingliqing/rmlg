<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»åŠ¡ä¸­å¿ƒæµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .test-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        .special-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            grid-column: 1 / -1;
            font-size: 16px;
            padding: 20px;
        }
        
        .result {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #28a745;
        }
        
        .result h4 {
            color: #28a745;
            margin-bottom: 8px;
        }
        
        .result p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .info-box {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        
        .info-box h4 {
            color: #1976d2;
            margin-bottom: 8px;
        }
        
        .info-box p {
            color: #555;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .status {
            text-align: center;
            padding: 10px;
            background: #fff3cd;
            border-radius: 8px;
            color: #856404;
            font-size: 14px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“± WebView æµ‹è¯•ä¸­å¿ƒ</h1>
            <p>æ¨¡æ‹Ÿ iOS App ä¸­çš„ H5 äº¤äº’åŠŸèƒ½</p>
        </div>
        
        <div class="content">
            <div class="status" id="status">
                ğŸ”— WebView å·²è¿æ¥ï¼Œå‡†å¤‡æµ‹è¯•...
            </div>
            
            <div class="test-section">
                <h3>ğŸ¯ çœŸå®è°ƒç”¨æ–¹å¼æµ‹è¯•</h3>
                <div class="button-grid">
                    <button class="test-btn special-btn" onclick="openTaskCenter()">
                        ğŸ† æ‰“å¼€ä»»åŠ¡ä¸­å¿ƒ
                    </button>
                </div>
                <p style="color: #666; font-size: 12px; text-align: center; margin-top: 10px;">
                    æ¨¡æ‹Ÿï¼šwindow.webkit.messageHandlers.openTaskCenter.postMessage(uni.getStorageSync('token'))
                </p>
            </div>
            
            <div class="test-section">
                <h3>ğŸ“± Token ç®¡ç†æµ‹è¯•</h3>
                <div class="button-grid">
                    <button class="test-btn" onclick="showCurrentToken()">
                        ğŸ”‘ æŸ¥çœ‹å½“å‰ Token
                    </button>
                    <button class="test-btn" onclick="refreshToken()">
                        ğŸ”„ åˆ·æ–° Token
                    </button>
                </div>
            </div>
            
            <div class="test-section">
                <h3>ğŸš€ å…¶ä»–åŠŸèƒ½æµ‹è¯•</h3>
                <div class="button-grid">
                    <button class="test-btn" onclick="openAiSports()">
                        ğŸƒâ€â™‚ï¸ AI è¿åŠ¨
                    </button>
                    <button class="test-btn" onclick="openChatPage()">
                        ğŸ’¬ èŠå¤©é¡µé¢
                    </button>
                    <button class="test-btn" onclick="shareVideo()">
                        ğŸ“¹ åˆ†äº«è§†é¢‘
                    </button>
                    <button class="test-btn" onclick="getUserId()">
                        ğŸ‘¤ è·å–ç”¨æˆ·ID
                    </button>
                </div>
            </div>
            
            <div class="test-section">
                <h3>ğŸ”§ ç³»ç»ŸåŠŸèƒ½</h3>
                <div class="button-grid">
                    <button class="test-btn" onclick="triggerLogin()">
                        ğŸ” æ¨¡æ‹Ÿç™»å½•
                    </button>
                    <button class="test-btn" onclick="triggerLogout()">
                        ğŸšª æ¨¡æ‹Ÿç™»å‡º
                    </button>
                    <button class="test-btn" onclick="jumpToAppStore()">
                        ğŸª è·³è½¬åº”ç”¨å•†åº—
                    </button>
                    <button class="test-btn" onclick="finishPage()">
                        âŒ å…³é—­é¡µé¢
                    </button>
                </div>
            </div>
            
            <div class="info-box">
                <h4>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h4>
                <p>è¿™ä¸ªé¡µé¢æ¨¡æ‹Ÿäº†ä½ çš„ Flutter WebView ä¸­çš„å„ç§ H5 äº¤äº’åŠŸèƒ½ã€‚ç‚¹å‡»æŒ‰é’®ä¼šè°ƒç”¨å¯¹åº”çš„ JavaScript æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¼šè¢«ä½ çš„ iOS åº”ç”¨æ¥æ”¶å¹¶å¤„ç†ã€‚</p>
            </div>
            
            <div class="result" id="result" style="display: none;">
                <h4>ğŸ“‹ æ“ä½œç»“æœ</h4>
                <p id="resultText">ç­‰å¾…æ“ä½œ...</p>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥æ˜¯å¦åœ¨ WebView ç¯å¢ƒä¸­
        function isInWebView() {
            return window.webkit && window.webkit.messageHandlers;
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const icons = {
                'info': 'ğŸ”—',
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ï¸'
            };
            status.textContent = `${icons[type]} ${message}`;
            status.className = 'status ' + type;
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(action, data = null) {
            const result = document.getElementById('result');
            const resultText = document.getElementById('resultText');
            
            let message = `è°ƒç”¨äº† ${action} åŠŸèƒ½`;
            if (data) {
                message += `ï¼Œå‚æ•°ï¼š${JSON.stringify(data)}`;
            }
            
            resultText.textContent = message;
            result.style.display = 'block';
            
            // 3ç§’åéšè—ç»“æœ
            setTimeout(() => {
                result.style.display = 'none';
            }, 3000);
        }
        
        // æ¨¡æ‹Ÿ uni-app çš„å­˜å‚¨ API
        const uni = {
            getStorageSync: function(key) {
                const mockData = {
                    'token': 'mock_token_123456789',
                    'userId': 'mock_user_12345',
                    'userInfo': JSON.stringify({
                        id: 'mock_user_12345',
                        name: 'æµ‹è¯•ç”¨æˆ·',
                        avatar: 'https://example.com/avatar.jpg'
                    }),
                    'appVersion': '1.0.0'
                };
                return mockData[key] || '';
            },
            setStorageSync: function(key, value) {
                console.log(`æ¨¡æ‹Ÿå­˜å‚¨: ${key} = ${value}`);
            }
        };
        
        // åˆå§‹åŒ–ä¸€äº›æµ‹è¯•æ•°æ®
        uni.setStorageSync('token', 'mock_token_123456789');
        uni.setStorageSync('userId', 'mock_user_12345');
        
        // å®‰å…¨è°ƒç”¨ WebKit æ–¹æ³•ï¼ˆå…¼å®¹åŸå§‹æ–¹å¼ï¼‰
        function callNative(handlerName, data = {}) {
            if (isInWebView()) {
                try {
                    window.webkit.messageHandlers[handlerName].postMessage(data);
                    updateStatus(`æˆåŠŸè°ƒç”¨ ${handlerName}`, 'success');
                    showResult(handlerName, data);
                } catch (error) {
                    updateStatus(`è°ƒç”¨ ${handlerName} å¤±è´¥: ${error.message}`, 'error');
                    console.error('è°ƒç”¨å¤±è´¥:', error);
                }
            } else {
                updateStatus(`æ¨¡æ‹Ÿè°ƒç”¨ ${handlerName}ï¼ˆé WebView ç¯å¢ƒï¼‰`, 'warning');
                showResult(handlerName + 'ï¼ˆæ¨¡æ‹Ÿï¼‰', data);
            }
        }
        
        // ç›´æ¥è°ƒç”¨æ–¹å¼ï¼ˆæ¨¡æ‹Ÿå‰ç«¯çœŸå®è°ƒç”¨ï¼‰
        function directCall(handlerName, data) {
            if (isInWebView()) {
                try {
                    window.webkit.messageHandlers[handlerName].postMessage(data);
                    updateStatus(`ç›´æ¥è°ƒç”¨ ${handlerName} æˆåŠŸ`, 'success');
                    showResult(`${handlerName}ï¼ˆç›´æ¥è°ƒç”¨ï¼‰`, data);
                } catch (error) {
                    updateStatus(`ç›´æ¥è°ƒç”¨ ${handlerName} å¤±è´¥: ${error.message}`, 'error');
                    console.error('ç›´æ¥è°ƒç”¨å¤±è´¥:', error);
                }
            } else {
                updateStatus(`æ¨¡æ‹Ÿç›´æ¥è°ƒç”¨ ${handlerName}ï¼ˆé WebView ç¯å¢ƒï¼‰`, 'warning');
                showResult(`${handlerName}ï¼ˆç›´æ¥è°ƒç”¨æ¨¡æ‹Ÿï¼‰`, data);
            }
        }
        
        // ä»»åŠ¡ä¸­å¿ƒ - æŒ‰ç…§å‰ç«¯çœŸå®è°ƒç”¨æ–¹å¼
        function openTaskCenter() {
            // æ–¹å¼1ï¼šæŒ‰ç…§å‰ç«¯çš„è°ƒç”¨æ–¹å¼
            const token = uni.getStorageSync('token');
            if (isInWebView() && window.webkit.messageHandlers.openTaskCenter) {
                window.webkit.messageHandlers.openTaskCenter.postMessage(token);
                updateStatus(`è°ƒç”¨ä»»åŠ¡ä¸­å¿ƒæˆåŠŸï¼Œtoken: ${token}`, 'success');
                showResult('openTaskCenterï¼ˆçœŸå®è°ƒç”¨æ–¹å¼ï¼‰', token);
            } else {
                updateStatus(`æ¨¡æ‹Ÿè°ƒç”¨ä»»åŠ¡ä¸­å¿ƒï¼Œtoken: ${token}`, 'warning');
                showResult('openTaskCenterï¼ˆæ¨¡æ‹ŸçœŸå®è°ƒç”¨ï¼‰', token);
            }
        }
        
        // AI è¿åŠ¨åŠŸèƒ½ - ä½¿ç”¨ uni-app æ–¹å¼
        function openAiSports() {
            const token = uni.getStorageSync('token');
            const userId = uni.getStorageSync('userId');
            
            // æ–¹å¼1ï¼šç›´æ¥ä¼  tokenï¼ˆå¦‚æœå‰ç«¯ä¹Ÿæ˜¯è¿™æ ·è°ƒç”¨ï¼‰
            if (isInWebView() && window.webkit.messageHandlers.openAiSports) {
                window.webkit.messageHandlers.openAiSports.postMessage(token);
                updateStatus(`è°ƒç”¨ AI è¿åŠ¨æˆåŠŸ`, 'success');
                showResult('openAiSportsï¼ˆçœŸå®è°ƒç”¨ï¼‰', token);
            } else {
                updateStatus(`æ¨¡æ‹Ÿè°ƒç”¨ AI è¿åŠ¨`, 'warning');
                showResult('openAiSportsï¼ˆæ¨¡æ‹Ÿï¼‰', token);
            }
        }
        
        // èŠå¤©é¡µé¢ - ä½¿ç”¨ uni-app æ–¹å¼
        function openChatPage() {
            const token = uni.getStorageSync('token');
            
            if (isInWebView() && window.webkit.messageHandlers.openChatPage) {
                window.webkit.messageHandlers.openChatPage.postMessage(token);
                updateStatus(`è°ƒç”¨èŠå¤©é¡µé¢æˆåŠŸ`, 'success');
                showResult('openChatPageï¼ˆçœŸå®è°ƒç”¨ï¼‰', token);
            } else {
                updateStatus(`æ¨¡æ‹Ÿè°ƒç”¨èŠå¤©é¡µé¢`, 'warning');
                showResult('openChatPageï¼ˆæ¨¡æ‹Ÿï¼‰', token);
            }
        }
        
        // åˆ†äº«è§†é¢‘ - ä½¿ç”¨ uni-app æ–¹å¼
        function shareVideo() {
            const token = uni.getStorageSync('token');
            
            if (isInWebView() && window.webkit.messageHandlers.shareAiVideo) {
                window.webkit.messageHandlers.shareAiVideo.postMessage(token);
                updateStatus(`è°ƒç”¨åˆ†äº«è§†é¢‘æˆåŠŸ`, 'success');
                showResult('shareAiVideoï¼ˆçœŸå®è°ƒç”¨ï¼‰', token);
            } else {
                updateStatus(`æ¨¡æ‹Ÿè°ƒç”¨åˆ†äº«è§†é¢‘`, 'warning');
                showResult('shareAiVideoï¼ˆæ¨¡æ‹Ÿï¼‰', token);
            }
        }
        
        // è·å–ç”¨æˆ·ID - ä½¿ç”¨ uni-app æ–¹å¼
        function getUserId() {
            const token = uni.getStorageSync('token');
            
            if (isInWebView() && window.webkit.messageHandlers.getUserId) {
                window.webkit.messageHandlers.getUserId.postMessage(token);
                updateStatus(`è°ƒç”¨è·å–ç”¨æˆ·IDæˆåŠŸ`, 'success');
                showResult('getUserIdï¼ˆçœŸå®è°ƒç”¨ï¼‰', token);
            } else {
                updateStatus(`æ¨¡æ‹Ÿè°ƒç”¨è·å–ç”¨æˆ·ID`, 'warning');
                showResult('getUserIdï¼ˆæ¨¡æ‹Ÿï¼‰', token);
            }
        }
        
        // Token ç®¡ç†åŠŸèƒ½
        function showCurrentToken() {
            const token = uni.getStorageSync('token');
            const userId = uni.getStorageSync('userId');
            updateStatus(`å½“å‰ Token: ${token.substring(0, 20)}...`, 'info');
            showResult('å½“å‰å­˜å‚¨ä¿¡æ¯', { token, userId });
        }
        
        function refreshToken() {
            const newToken = 'refresh_token_' + Date.now();
            uni.setStorageSync('token', newToken);
            updateStatus(`Token å·²åˆ·æ–°`, 'success');
            showResult('Token åˆ·æ–°', { newToken });
        }
        
        // ç™»å½•äº‹ä»¶ - ä½¿ç”¨ uni-app æ–¹å¼
        function triggerLogin() {
            const token = uni.getStorageSync('token');
            const userInfo = {
                token: token,
                userId: uni.getStorageSync('userId'),
                loginTime: Date.now()
            };
            
            if (isInWebView() && window.webkit.messageHandlers.onLoginEvent) {
                window.webkit.messageHandlers.onLoginEvent.postMessage(userInfo);
                updateStatus(`è§¦å‘ç™»å½•äº‹ä»¶æˆåŠŸ`, 'success');
                showResult('onLoginEventï¼ˆçœŸå®è°ƒç”¨ï¼‰', userInfo);
            } else {
                updateStatus(`æ¨¡æ‹Ÿè§¦å‘ç™»å½•äº‹ä»¶`, 'warning');
                showResult('onLoginEventï¼ˆæ¨¡æ‹Ÿï¼‰', userInfo);
            }
        }
        
        // ç™»å‡ºäº‹ä»¶ - ç›´æ¥è°ƒç”¨ï¼ˆé€šå¸¸ä¸éœ€è¦å‚æ•°ï¼‰
        function triggerLogout() {
            if (isInWebView() && window.webkit.messageHandlers.onLogoutEvent) {
                window.webkit.messageHandlers.onLogoutEvent.postMessage('');
                updateStatus(`è§¦å‘ç™»å‡ºäº‹ä»¶æˆåŠŸ`, 'success');
                showResult('onLogoutEventï¼ˆçœŸå®è°ƒç”¨ï¼‰', '');
            } else {
                updateStatus(`æ¨¡æ‹Ÿè§¦å‘ç™»å‡ºäº‹ä»¶`, 'warning');
                showResult('onLogoutEventï¼ˆæ¨¡æ‹Ÿï¼‰', '');
            }
        }
        
        // è·³è½¬ App Store - ä½¿ç”¨ uni-app æ–¹å¼
        function jumpToAppStore() {
            const appInfo = {
                appId: "123456789",
                from: "webview",
                timestamp: Date.now()
            };
            
            if (isInWebView() && window.webkit.messageHandlers.jumpToAppStore) {
                window.webkit.messageHandlers.jumpToAppStore.postMessage(appInfo);
                updateStatus(`è·³è½¬åº”ç”¨å•†åº—æˆåŠŸ`, 'success');
                showResult('jumpToAppStoreï¼ˆçœŸå®è°ƒç”¨ï¼‰', appInfo);
            } else {
                updateStatus(`æ¨¡æ‹Ÿè·³è½¬åº”ç”¨å•†åº—`, 'warning');
                showResult('jumpToAppStoreï¼ˆæ¨¡æ‹Ÿï¼‰', appInfo);
            }
        }
        
        // å…³é—­é¡µé¢ - ç›´æ¥è°ƒç”¨
        function finishPage() {
            if (isInWebView() && window.webkit.messageHandlers.onFinishPage) {
                window.webkit.messageHandlers.onFinishPage.postMessage('');
                updateStatus(`å…³é—­é¡µé¢è°ƒç”¨æˆåŠŸ`, 'success');
                showResult('onFinishPageï¼ˆçœŸå®è°ƒç”¨ï¼‰', '');
            } else {
                updateStatus(`æ¨¡æ‹Ÿå…³é—­é¡µé¢`, 'warning');
                showResult('onFinishPageï¼ˆæ¨¡æ‹Ÿï¼‰', '');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆæ—¶æ£€æŸ¥ç¯å¢ƒ
        document.addEventListener('DOMContentLoaded', function() {
            if (isInWebView()) {
                updateStatus('WebView ç¯å¢ƒæ£€æµ‹æˆåŠŸï¼Œå¯ä»¥æ­£å¸¸æµ‹è¯•', 'success');
            } else {
                updateStatus('å½“å‰åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆï¼Œå®é™…åŠŸèƒ½éœ€è¦åœ¨ WebView ä¸­æµ‹è¯•', 'warning');
            }
        });
        
        // åŠ¨æ€æ›´æ–°é¡µé¢æ ‡é¢˜ï¼ˆæµ‹è¯•æ ‡é¢˜æ›´æ–°åŠŸèƒ½ï¼‰
        let titleCounter = 0;
        setInterval(() => {
            titleCounter++;
            if (titleCounter % 10 === 0) {
                document.title = `ä»»åŠ¡ä¸­å¿ƒæµ‹è¯•é¡µé¢ (${titleCounter})`;
            }
        }, 1000);
    </script>
</body>
</html>
